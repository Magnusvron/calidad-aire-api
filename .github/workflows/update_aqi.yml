name: update-database

on:
  workflow_dispatch:  # permite correrlo manualmente desde GitHub
  schedule:
    - cron: '0 * * * *'  # cada hora (puedes cambiarlo)

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - name: Clonar el repositorio
      uses: actions/checkout@v3

    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Instalar dependencias
      run: |
        pip install -r requirements.txt

    - name: Verificar si requests est√° instalado
      run: pip show requests || echo "requests no instalado"
      
    - name: Verificar conectividad Supabase
      run: curl -I https://mjcnbgzqjhihjbbblvbi.supabase.co


    - name: Ejecutar el cron job
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        AQICN_TOKEN: ${{ secrets.AQICN_TOKEN }}
        AQICN_STATION: ${{ secrets.AQICN_STATION }}
      run: python cron_job.py
