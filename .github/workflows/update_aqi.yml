name: Actualizar Base de Datos

on:
  schedule:
    - cron: '0 * * * *'  # cada hora
  workflow_dispatch:     # permite correrlo manualmente desde GitHub

jobs:
  update-db:
    runs-on: ubuntu-latest

    steps:
    - name: Clonar el repositorio
      uses: actions/checkout@v3

    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Instalar dependencias
      run: pip install -r requirements.txt
      
    - name: Mostrar valor de SUPABASE_URL
      run: echo "SUPABASE_URL=${SUPABASE_URL}"
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}


    - name: Probar conectividad con Supabase
      run: curl -i ${{ secrets.SUPABASE_URL }}


    - name: Ejecutar script de actualizaci√≥n
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        AQICN_TOKEN: ${{ secrets.AQICN_TOKEN }}
        AQICN_STATION: ${{ secrets.AQICN_STATION }}
      run: python cron_job.py
